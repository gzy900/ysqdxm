/*Obfuscated by JShaman.com*/var ctx=null;var canvas={'width':0x0,'height':0x0,'lattice_size':0x0,'lattice_data_x':0xc8,'lattice_data_y':0.5,'max_data_x':0x0,'max_data_y':0x0,'data_index':0x0,'rate':0xc8,'center_diff':0x0,'unit_min_x':0x0,'prev_y':0x0,'init':function(_0x5e0d32){const _0x194a41=this;const _0x53de21=wx['createSelectorQuery']();_0x53de21['select']('#'+_0x5e0d32)['fields']({'node':!![],'size':!![]})['exec'](_0x27204f=>{const _0x2511fb=_0x27204f[0xa8b42^0xa8b42]['node'];ctx=_0x2511fb['getContext']('2d');let _0x3d4cfd=wx['getSystemInfoSync']();let _0x4d46a9=_0x3d4cfd['windowWidth'];let _0x14425d=_0x3d4cfd['windowHeight'];_0x2511fb['width']=_0x4d46a9;_0x2511fb['height']=_0x14425d/(0xc6bc5^0xc6bc7);_0x194a41['width']=_0x4d46a9;_0x194a41['height']=_0x14425d/(0xb5bef^0xb5bed);_0x194a41['lattice_size']=_0x194a41['height']/(0x5387a^0x5386e);_0x194a41['max_data_x']=Math['floor'](_0x194a41['width']/_0x194a41['lattice_size']*(_0x194a41['lattice_data_x']/((0xedd46^0xedeae)/_0x194a41['rate'])));_0x194a41['unit_min_x']=_0x194a41['lattice_size']/(_0x194a41['lattice_data_x']/((0x4e88d^0x4eb65)/_0x194a41['rate']));});},'accept_data':function(_0x5c894c){const _0x2c78cd=this;const _0x30f640=Array['prototype']['slice']['call'](new Int8Array(_0x5c894c['value']));if(_0x2c78cd['data_index']>_0x2c78cd['max_data_x']-(0x2c9ea^0x2c9e0)){_0x2c78cd['data_index']=0xb47a6^0xb47a6;ctx['clearRect'](0x1d3d1^0x1d3d1,0x425e9^0x425e9,_0x2c78cd['width'],_0x2c78cd['height']);}ctx['beginPath']();for(let _0x46708d=0x0;_0x46708d<(0xdbb1a^0xdbb0e);_0x46708d+=0xb617f^0xb617d){const _0x1c43c2=_0x30f640[_0x46708d]>=(0x43c19^0x43c19)?_0x30f640[_0x46708d]:_0x30f640[_0x46708d]+0x100;const _0x1c18f7=0x0-(_0x1c43c2+_0x30f640[_0x46708d+0x1]*(0x681ce^0x680ce))/(0x6edc1^0x6ef41)+0x6;const _0x3db960=_0x1c18f7/_0x2c78cd['lattice_data_y']*_0x2c78cd['lattice_size'];if(_0x2c78cd['data_index']===(0x5a3c5^0x5a3c5)){_0x2c78cd['center_diff']=_0x3db960-_0x2c78cd['height']/(0xb4a42^0xb4a40);_0x3db960=_0x2c78cd['height']/0x2;}if(_0x46708d===(0xa23ec^0xa23ec)){if(_0x2c78cd['data_index']===0x0){ctx['moveTo'](_0x2c78cd['data_index']*_0x2c78cd['unit_min_x'],0x0-_0x3db960-_0x2c78cd['center_diff']);}else{ctx['moveTo'](_0x2c78cd['data_index']*_0x2c78cd['unit_min_x'],_0x2c78cd['prev_y']);}}else{ctx['lineTo'](_0x2c78cd['data_index']*_0x2c78cd['unit_min_x'],(0xb6f60^0xb6f60)-_0x3db960-_0x2c78cd['center_diff']);}if(_0x46708d>=(0xcb7b8^0xcb7aa)){_0x2c78cd['prev_y']=(0xa3172^0xa3172)-_0x3db960-_0x2c78cd['center_diff'];}_0x2c78cd['data_index']++;}ctx['stroke']();}};var ble={'name':'','ble_status':0x0,'connect_status':![],'device_id':'','battery':0x0,'cv_change_callback':![],'ecg_data':null,'ecg_data_view':null,'ecg_index':0x0,'service_list':{'write':{'serviceId':'0000FFF0-0000-1000-8000-00805F9B34FB','characteristicId':'','isread':![],'desc':'发送'},'read':{'serviceId':'0000FFE0-0000-1000-8000-00805F9B34FB','characteristicId':'','isread':![],'desc':'接收'},'ecg':{'serviceId':'0000FFB1-0000-1000-8000-00805F9B34FB','characteristicId':'','isread':![],'desc':'心电'},'battery':{'serviceId':'0000180F-0000-1000-8000-00805F9B34FB','characteristicId':'','isread':![],'desc':'电池'}},'search':function({success:_0x4a047e=null,fail:_0x4750ee=null}={}){const _0x1678c0=this;return new Promise((_0xd925b1,_0x4a6689)=>{_0x1678c0['open_ble']()['then'](_0x21b4c2=>{console['log']('openBluetoothAdapter\x20res=>',_0x21b4c2);_0x1678c0['ble_status']=0x1;_0x1678c0['open_search_ble']();})['then'](_0x28db55=>{console['log']('startBluetoothDevicesDiscovery\x20res=>',_0x28db55);if(typeof _0x4a047e=='function'){_0x1678c0['search_callback_ble'](_0x4a047e);console['log']('开启搜索');}})['catch'](_0x4c1952=>{console['log'](_0x4c1952);if(typeof _0x4750ee=='function'){_0x4750ee(_0x4c1952);}});});},'close_search':function(){wx['stopBluetoothDevicesDiscovery']({'success'(_0x388aaf){},'fail'(_0x1c9898){console['log'](_0x1c9898);}});},'connect':function({device_id:_0x264962,success:_0x4ef414,fail:_0xe58316}={}){if(!_0x264962){console['error']('缺少蓝牙设备Id');if(typeof _0xe58316=='function'){_0xe58316({'msg':'缺少蓝牙设备Id'});}return;}const _0x12fb1b=this;_0x12fb1b['close_search']();return new Promise((_0x2f9b18,_0x1eb86e)=>{_0x12fb1b['connect_ble'](_0x264962)['then'](async _0x51844f=>{console['log']('蓝牙连接成功');_0x12fb1b['device_id']=_0x264962;const _0x336666=await _0x12fb1b['get_service'](_0x264962);return _0x336666;})['then'](async _0x2d9bb2=>{console['log']('搜索服务成功');console['log'](_0x2d9bb2);let _0x4b8775=_0x2d9bb2['services'];const _0x21fce1=[];_0x4b8775['forEach'](_0x224db2=>{if(_0x224db2['isPrimary']){const _0x14caee=_0x12fb1b['get_characteristic'](_0x264962,_0x224db2['uuid']);_0x21fce1['push'](_0x14caee);}});Promise['all'](_0x21fce1)['then'](_0x1f2298=>{console['log']('全部完成');console['log'](_0x1f2298);_0x1f2298['forEach'](_0x58db96=>{for(let _0x427a57 in _0x12fb1b['service_list']){let _0x39a8e4=_0x12fb1b['service_list'][_0x427a57];if(_0x58db96['service_id']===_0x39a8e4['serviceId']){_0x39a8e4['isread']=!![];_0x39a8e4['characteristicId']=_0x58db96['characteristics'][0xe89be^0xe89be]['uuid'];}}});const _0x2b4ad5=_0x12fb1b['service_list']['battery'];_0x12fb1b['notify'](_0x12fb1b['device_id'],_0x2b4ad5['serviceId'],_0x2b4ad5['characteristicId'])['then'](_0x37227a=>{_0x12fb1b['notify_callback'](_0x208b65=>{if(_0x208b65['characteristicId']==='00002A19-0000-1000-8000-00805F9B34FB'){const _0x4af2ed=new DataView(_0x208b65['value']);_0x12fb1b['battery']=_0x4af2ed['getUint8'](0x2edab^0x2edab);console['log'](_0x12fb1b['battery']);}if(typeof _0x4ef414=='function'){_0x4ef414('蓝牙连接成功，现在get_battery\x20get_data方法已可用');}});_0x12fb1b['read'](_0x12fb1b['device_id'],_0x2b4ad5['serviceId'],_0x2b4ad5['characteristicId']);});_0x2f9b18(_0x1f2298);});})['catch'](_0x16824c=>{if(typeof _0xe58316=='function'){_0xe58316(_0x16824c);}});});},'close_connect':function(){const _0x2d3ac3=this;wx['closeBLEConnection']({'deviceId':_0x2d3ac3['device_id'],'success'(_0x56e10f){},'fail'(_0x4358bc){console['error'](_0x4358bc);}});},'get_battery':function(){const _0x5a4480=this;return _0x5a4480['battery'];},'get_data_real_time':function({time:time=0x2,callback:_0x21f1cd,canvas_id:canvas_id=null}={}){if(typeof _0x21f1cd!=='function'){console['error']('需要传入回调方法callback');return;}time=time*(0xf2a48^0xf2a74);const _0x1f4a6d=this;_0x1f4a6d['ecg_data']=new ArrayBuffer(time*(0x7ebd5^0x7eb1d)*0x2);_0x1f4a6d['ecg_data_view']=new DataView(_0x1f4a6d['ecg_data']);if(canvas_id!==null){canvas['init'](canvas_id);}return new Promise((_0x30697a,_0x3095b3)=>{const _0x6bc506=_0x1f4a6d['service_list']['ecg'];_0x1f4a6d['notify'](_0x1f4a6d['device_id'],_0x6bc506['serviceId'],_0x6bc506['characteristicId'])['then'](_0x1e843b=>{_0x1f4a6d['notify_callback'](_0x35e4b7=>{_0x1f4a6d['append_data'](_0x35e4b7['value'],_0x1f4a6d['ecg_index']);_0x1f4a6d['ecg_index']++;if(_0x1f4a6d['ecg_index']%(0xc8/0xa)===0x0){const _0x5cbcfb={'code':0xc8,'status':0x1,'past_time':_0x1f4a6d['ecg_index']/(0xc8/(0x45ead^0x45ea7)),'data':''};if(_0x1f4a6d['ecg_index']/(0xc8/0xa)===time){_0x5cbcfb['status']=0x2;_0x1f4a6d['close_connect']();_0x5cbcfb['data']=_0x1f4a6d['compress_data']();}_0x21f1cd(_0x5cbcfb);}if(canvas_id!==null&&_0x35e4b7['characteristicId']===_0x1f4a6d['service_list']['ecg']['characteristicId']){canvas['accept_data'](_0x35e4b7);}});});});},'init':function(){},'reset':function(){},'compress_data':function(){const _0x410638=this;console['log'](_0x410638['ecg_data']);return _0x410638['ecg_data'];},'open_ble':function(){const _0x44bdb1=this;return new Promise((_0x554463,_0x16dfef)=>{wx['openBluetoothAdapter']({'success'(_0x4bd1fa){_0x554463(_0x4bd1fa);},'fail'(_0x1ff27e){console['log']('openBluetoothAdapter\x20err=>',_0x1ff27e);if(_0x1ff27e&&_0x1ff27e['errMsg']['indexOf']('openBluetoothAdapter:fail')>=0x0){_0x1ff27e['errCode']=0xce27b^0xcc56b;}_0x16dfef(_0x1ff27e);}});});},'open_search_ble':function(){const _0xfa13bf=this;return new Promise((_0xe9d7db,_0x44f49a)=>{wx['startBluetoothDevicesDiscovery']({'services':['0000FFB1-0000-1000-8000-00805F9B34FB'],'allowDuplicatesKey':![],'success'(_0x347c12){_0xe9d7db(_0x347c12);},'fail'(_0x3e1944){console['log']('startBluetoothDevicesDiscovery\x20err=>',_0x3e1944);_0x44f49a(_0x3e1944);}});});},'search_callback_ble':function(_0x31e8a2){wx['onBluetoothDeviceFound'](function(_0x1ead16){_0x31e8a2(_0x1ead16);});},'connect_ble':function(_0x388745){return new Promise((_0x4a028c,_0x1fcdf5)=>{wx['createBLEConnection']({'deviceId':_0x388745,'success'(_0x30d11a){_0x4a028c(_0x30d11a);},'fail'(_0x380556){console['log']('createBLEConnection\x20err,useTime=>',_0x380556);_0x1fcdf5(_0x380556);}});});},'get_service':function(_0xcd0f47){return new Promise((_0x31a858,_0x53461d)=>{wx['getBLEDeviceServices']({'deviceId':_0xcd0f47})['then'](_0x3a1960=>{_0x31a858(_0x3a1960);})['catch'](_0x3e66b4=>{console['log']('device\x20services\x20err=>',_0x3e66b4);_0x53461d(_0x3e66b4);});});},'get_characteristic':function(_0x2a94eb,_0x40ed4f){return new Promise((_0x3a112f,_0x94d112)=>{wx['getBLEDeviceCharacteristics']({'deviceId':_0x2a94eb,'serviceId':_0x40ed4f})['then'](_0x5345c5=>{console['log']('获取特征成功');console['log']('device\x20getBLEDeviceCharacteristics:',_0x5345c5['characteristics']);_0x3a112f({'service_id':_0x40ed4f,'characteristics':_0x5345c5['characteristics']});})['catch'](_0x290b19=>{console['log']('device\x20getBLEDeviceCharacteristics\x20err=>',_0x290b19);_0x94d112(_0x290b19);});});},'write':function(_0x1c6451,_0x3882ed,_0x1cad4b,_0x12900f){return new Promise((_0x5a7a19,_0x26a0ae)=>{wx['writeBLECharacteristicValue']({'deviceId':_0x1c6451,'serviceId':_0x3882ed,'characteristicId':_0x1cad4b,'value':_0x12900f,'success':_0x1d212c=>{_0x5a7a19(_0x1d212c);},'fail':_0x5d9755=>{console['log']('writeBLECharacteristicValue\x20err',_0x5d9755);_0x26a0ae(_0x5d9755);}});});},'read':function(_0x4dee8b,_0x21aa06,_0x5dfe69){return new Promise((_0x5231ee,_0x4b042f)=>{wx['readBLECharacteristicValue']({'deviceId':_0x4dee8b,'serviceId':_0x21aa06,'characteristicId':_0x5dfe69,'success'(_0x4ca3dc){console['log']('readBLECharacteristicValue:',_0x4ca3dc);_0x5231ee(_0x4ca3dc);},'fail'(_0x234179){console['log']('readBLECharacteristicValue\x20err',_0x234179);_0x4b042f(_0x234179);}});});},'notify':function(_0x1c5133,_0x154967,_0x6ce12d){return new Promise((_0x340d70,_0x163157)=>{wx['notifyBLECharacteristicValueChange']({'state':!![],'type':'notification','deviceId':_0x1c5133,'serviceId':_0x154967,'characteristicId':_0x6ce12d,'success'(_0xf809e){console['log']('notifyBLECharacteristicValueChange\x20success',_0xf809e['errMsg']);_0x340d70(_0xf809e);},'fail'(_0x8baaec){console['log']('notifyBLECharacteristicValueChange\x20err',_0x8baaec);_0x163157(_0x8baaec);}});});},'notify_callback':function(_0x3612de){const _0x5afdd4=this;if(_0x5afdd4['cv_change_callback']){wx['offBLECharacteristicValueChange'](()=>{_0x5afdd4['cv_change_callback']=![];});}wx['onBLECharacteristicValueChange'](function(_0x5a3374){_0x5afdd4['cv_change_callback']=!![];_0x3612de(_0x5a3374);});console['log']('数据回调注册成功');},'append_data':function(_0x5a69dc,_0x12bd18){const _0x538950=this;const _0x3f734b=new DataView(_0x5a69dc);for(let _0x1dd0c4=0x3f5ac^0x3f5ac;_0x1dd0c4<(0x6ca20^0x6ca34);_0x1dd0c4++){_0x538950['ecg_data_view']['setUint8'](_0x12bd18*(0xa300d^0xa3019)+_0x1dd0c4,_0x3f734b['getUint8'](_0x1dd0c4));}}};module['exports']={'ble':ble};