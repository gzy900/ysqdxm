{"version":3,"sources":["__temp/buildProcess/inlineFunctionProcess/Scripts/ui/TouchLayerBase.ts"],"names":[],"mappings":";;;AAAA,iCAA4B;AAQ5B,IAAM,OAAO,GAAG,gBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;AAE5C;IAA4C,0CAAa;IAarD,wBAA4B,MAAgB;QAA5C,YACI,kBAAM,MAAM,CAAC,SAQhB;QAT2B,YAAM,GAAN,MAAM,CAAU;QAZrC,oBAAc,GAAsC,IAAI,CAAC;QACzD,iBAAW,GAAyB,IAAI,CAAC;QACzC,iBAAW,GAAyB,IAAI,CAAC;QACzC,gBAAU,GAAyB,IAAI,CAAC;QACxC,iBAAW,GAAyB,IAAI,CAAC;QACzC,eAAS,GAAyB,IAAI,CAAC;QACvC,kBAAY,GAAyB,IAAI,CAAC;QAEzC,iBAAW,GAAY,gBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;QACnD,gBAAU,GAAY,gBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;QAClD,eAAS,GAAY,gBAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;QAIrD,KAAI,CAAC,cAAc,GAAG,KAAI,CAAC,YAAY,CAA6B,gBAAM,CAAC,mBAAmB,CAAC,CAAC;QAChG,KAAI,CAAC,YAAY,GAAG,KAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QACjD,KAAI,CAAC,YAAY,GAAG,KAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QACjD,KAAI,CAAC,WAAW,GAAG,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QAC/C,KAAI,CAAC,UAAU,GAAG,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QAC7C,KAAI,CAAC,YAAY,GAAG,KAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QACjD,KAAI,CAAC,aAAa,GAAG,KAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;;IACvD,CAAC;IAEM,iCAAQ,GAAf;QACI,IAAI,IAAI,CAAC,cAAc,EAAE;YACrB,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACxD,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACxD,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACpD,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACxD,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YACtD,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;SAC3D;IACP,CAAC;IAEM,kCAAS,GAAhB;QACI,IAAI,IAAI,CAAC,cAAc,EAAE;YACrB,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC3D,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC3D,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACvD,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC3D,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YACzD,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;SAChE;IACL,CAAC;IAEM,yCAAgB,GAAvB,UAAwB,EAAiB;QACrC,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;IAC1B,CAAC;IAEM,yCAAgB,GAAvB,UAAwB,EAAiB;QACrC,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;IAC1B,CAAC;IAEM,wCAAe,GAAtB,UAAuB,EAAiB;QACpC,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;IACzB,CAAC;IAEM,yCAAgB,GAAvB,UAAwB,EAAiB;QACrC,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;IAC1B,CAAC;IAEM,uCAAc,GAArB,UAAsB,EAAiB;QACnC,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;IACxB,CAAC;IAEM,0CAAiB,GAAxB,UAAyB,EAAiB;QACtC,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;IAC3B,CAAC;IAEO,qCAAY,GAApB,UAAqB,CAA6B,EAAE,CAAkB;QAClE,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC7C,IAAI,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC7C,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,IAAI,CAAC,WAAW,EAAE;YAClB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;SACvE;QACD,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAA;IAC3C,CAAC;IAEO,qCAAY,GAApB,UAAqB,CAA6B,EAAE,CAAkB;QAClE,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,IAAI,CAAC,WAAW,EAAE;YAClB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;SACvE;IACL,CAAC;IAEO,oCAAW,GAAnB,UAAoB,CAA6B,EAAE,CAAkB;QACjE,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;SACtE;IACL,CAAC;IAEO,qCAAY,GAApB,UAAqB,CAA6B,EAAE,CAAkB;QAClE,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,IAAI,CAAC,WAAW,EAAE;YAClB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;SACvE;QACD,IAAI,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC;QACvB,IAAI,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC;IAC3B,CAAC;IAEO,mCAAU,GAAlB,UAAmB,CAA6B,EAAE,CAAkB;QAChE,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,IAAI,CAAC,SAAS,EAAE;YAChB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;SACrE;QACD,IAAI,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC;QACvB,IAAI,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC;IAC3B,CAAC;IAEO,sCAAa,GAArB,UAAsB,CAA6B,EAAE,CAAkB;QACnE,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3C,IAAI,IAAI,CAAC,SAAS,EAAE;YAChB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;SACrE;QACD,IAAI,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC;QACvB,IAAI,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC;IAC3B,CAAC;IACL,qBAAC;AAAD,CA1IA,AA0IC,CA1I2C,gBAAM,CAAC,MAAM,GA0IxD","file":"TouchLayerBase.js","sourcesContent":["import engine from \"engine\";\ndeclare type TouchInputEvent = engine.TouchInputEvent;\ndeclare type Entity2D = engine.Entity2D;\ndeclare type Vector2 = engine.Vector2;\n\nexport type TouchCallback = (start: engine.Vector2,last: engine.Vector2, current: engine.Vector2) => void;\n\n\nconst TMPZERO = engine.Vector2.ZERO.clone();\n\nexport default class TouchLayerBase extends engine.Script {\n    public touchInputComp: engine.TouchInputComponent | null = null;\n    public _touchStart: TouchCallback | null = null;\n    public _touchEnter: TouchCallback | null = null;\n    public _touchMove: TouchCallback | null = null;\n    public _touchLeave: TouchCallback | null = null;\n    public _touchEnd: TouchCallback | null = null;\n    public _touchCancel: TouchCallback | null = null;\n\n    private _startTouch: Vector2 = engine.Vector2.ZERO.clone();\n    private _lastTouch: Vector2 = engine.Vector2.ZERO.clone();\n    private _curTouch: Vector2 = engine.Vector2.ZERO.clone();\n      \n    constructor(public readonly entity: Entity2D) {\n        super(entity);\n        this.touchInputComp = this.getComponent<engine.TouchInputComponent>(engine.TouchInputComponent);\n        this.onTouchStart = this.onTouchStart.bind(this);\n        this.onTouchEnter = this.onTouchEnter.bind(this);\n        this.onTouchMove = this.onTouchMove.bind(this);\n        this.onTouchEnd = this.onTouchEnd.bind(this);\n        this.onTouchLeave = this.onTouchLeave.bind(this);\n        this.onTouchCancel = this.onTouchCancel.bind(this);\n    }\n\n    public onEnable() {\n        if (this.touchInputComp) {\n            this.touchInputComp.onTouchStart.add(this.onTouchStart);\n            this.touchInputComp.onTouchEnter.add(this.onTouchEnter);\n            this.touchInputComp.onTouchEnd.add(this.onTouchEnd);\n            this.touchInputComp.onTouchLeave.add(this.onTouchLeave);\n            this.touchInputComp.onTouchMove.add(this.onTouchMove);\n            this.touchInputComp.onTouchCancel.add(this.onTouchCancel);\n          }\n    }\n\n    public onDisable() {\n        if (this.touchInputComp) {\n            this.touchInputComp.onTouchStart.remove(this.onTouchStart);\n            this.touchInputComp.onTouchEnter.remove(this.onTouchEnter);\n            this.touchInputComp.onTouchEnd.remove(this.onTouchEnd);\n            this.touchInputComp.onTouchLeave.remove(this.onTouchLeave);\n            this.touchInputComp.onTouchMove.remove(this.onTouchMove);\n            this.touchInputComp.onTouchCancel.remove(this.onTouchCancel);\n        }\n    }\n    \n    public registTouchStart(cb: TouchCallback) {\n        this._touchStart = cb;\n    }\n\n    public registTouchEnter(cb: TouchCallback) {\n        this._touchEnter = cb;\n    }\n\n    public registTouchMove(cb: TouchCallback) {\n        this._touchMove = cb;\n    }\n\n    public registTouchLeave(cb: TouchCallback) {\n        this._touchLeave = cb;\n    }\n\n    public registTouchEnd(cb: TouchCallback) {\n        this._touchEnd = cb;\n    }\n\n    public registTouchCancel(cb: TouchCallback) {\n        this._touchCancel = cb;\n    }\n\n    private onTouchStart(s: engine.TouchInputComponent, e: TouchInputEvent) {\n        this._lastTouch.x = this._curTouch.x;\n        this._lastTouch.y = this._curTouch.y;\n        this._startTouch.x = e.touches[0].position.x;\n        this._startTouch.y = e.touches[0].position.y;\n        this._curTouch.x = e.touches[0].position.x;\n        this._curTouch.y = e.touches[0].position.y;\n        if( this._touchStart) {\n            this._touchStart(this._startTouch, this._lastTouch, this._curTouch);\n        }\n        this._lastTouch = e.touches[0].position\n    }\n    \n    private onTouchEnter(s: engine.TouchInputComponent, e: TouchInputEvent) {\n        this._lastTouch.x = this._curTouch.x;\n        this._lastTouch.y = this._curTouch.y;\n        this._curTouch.x = e.touches[0].position.x;\n        this._curTouch.y = e.touches[0].position.y;\n        if( this._touchEnter) {\n            this._touchEnter(this._startTouch, this._lastTouch, this._curTouch);\n        }\n    }\n    \n    private onTouchMove(s: engine.TouchInputComponent, e: TouchInputEvent) {\n        this._lastTouch.x = this._curTouch.x;\n        this._lastTouch.y = this._curTouch.y;\n        this._curTouch.x = e.touches[0].position.x;\n        this._curTouch.y = e.touches[0].position.y;\n        if( this._touchMove) {\n            this._touchMove(this._startTouch, this._lastTouch, this._curTouch);\n        }\n    }\n    \n    private onTouchLeave(s: engine.TouchInputComponent, e: TouchInputEvent) {\n        this._lastTouch.x = this._curTouch.x;\n        this._lastTouch.y = this._curTouch.y;\n        this._curTouch.x = e.touches[0].position.x;\n        this._curTouch.y = e.touches[0].position.y;\n        if( this._touchLeave) {\n            this._touchLeave(this._startTouch, this._lastTouch, this._curTouch);\n        }\n        this._startTouch.x = 0;\n        this._startTouch.y = 0;\n    }\n    \n    private onTouchEnd(s: engine.TouchInputComponent, e: TouchInputEvent) {\n        this._lastTouch.x = this._curTouch.x;\n        this._lastTouch.y = this._curTouch.y;\n        this._curTouch.x = e.touches[0].position.x;\n        this._curTouch.y = e.touches[0].position.y;\n        if( this._touchEnd) {\n            this._touchEnd(this._startTouch, this._lastTouch, this._curTouch);\n        }\n        this._startTouch.x = 0;\n        this._startTouch.y = 0;\n    }\n\n    private onTouchCancel(s: engine.TouchInputComponent, e: TouchInputEvent) {\n        this._lastTouch.x = this._curTouch.x;\n        this._lastTouch.y = this._curTouch.y;\n        this._curTouch.x = e.touches[0].position.x;\n        this._curTouch.y = e.touches[0].position.y;\n        if( this._touchEnd) {\n            this._touchEnd(this._startTouch, this._lastTouch, this._curTouch);\n        }\n        this._startTouch.x = 0;\n        this._startTouch.y = 0;\n    }\n}"]}