{"version":3,"sources":["__temp/buildProcess/inlineFunctionProcess/Scripts/ui/MoveTouchLayer.ts"],"names":[],"mappings":"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","file":"MoveTouchLayer.js","sourcesContent":["/*\n * @Athour: kumozheng\n * @Date: 2021-08-31 15:56:47\n * @LastEditors: kumozheng\n * @LastEditTime: 2021-08-31 20:32:43\n * @Description: \n * @FilePath: /RenderDemo copy/assets/Scripts/ui/MoveTouchLayer.ts\n */\nimport engine from \"engine\";\nimport TouchLayerBase from \"./TouchLayerBase\";\nimport EventManager from \"../event/EventManager\" \n\ndeclare type Entity2D = engine.Entity2D;\n\n// Cusor移动范围\nconst CUSOR_RANGE = 30;\n\n@engine.decorators.serialize(\"MoveTouchLayer\")\nexport default class MoveTouchLayer extends TouchLayerBase {\n    public cursor: engine.Entity | null = null;\n\n    private _pos: engine.Vector2 = engine.Vector2.ZERO.clone();\n    private _dir: engine.Vector2 = engine.Vector2.ZERO.clone();\n\n    constructor(public readonly entity: Entity2D) {\n        super(entity);\n    }\n\n    public onUpdate() {\n\n    }\n\n    public onAwake() {\n        this.cursor = this.entity.transform2D.findChildByName('Cursor').entity;\n        this.onCustomMove = this.onCustomMove.bind(this);\n        this.onCustomTouchEnd = this.onCustomTouchEnd.bind(this);\n        this.onCustomTouchCancel = this.onCustomTouchCancel.bind(this);\n        \n        this.registTouchMove(this.onCustomMove);\n        this.registTouchEnd(this.onCustomTouchEnd)\n        this.registTouchCancel(this.onCustomTouchCancel);\n    }\n\n    private onCustomTouchCancel(start: engine.Vector2, last: engine.Vector2, current: engine.Vector2) {\n        // 返回中心位置\n        this.setCursorPos(0, 0);\n        EventManager.emit(EventManager.CharacterMoveStop);\n    }\n\n    private onCustomTouchEnd(start: engine.Vector2, last: engine.Vector2, current: engine.Vector2) {\n        // 返回中心位置\n        this.setCursorPos(0, 0);\n        EventManager.emit(EventManager.CharacterMoveStop);\n    }\n\n    private onCustomMove(start: engine.Vector2, last: engine.Vector2, current: engine.Vector2) {\n        this.setCursorPos(current.x, current.y);\n        this._dir.x = current.x;\n        this._dir.y = current.y;\n        this._dir.normalize(this._dir);\n        // 通知角色move\n        EventManager.emit(EventManager.CharacterMove, this._dir);\n    }\n\n    private setCursorPos(x: number, y: number) {\n        this._pos.x = x;\n        this._pos.y = y;\n        if(this._pos.length() > CUSOR_RANGE) {\n            this._pos.normalize(this._pos);\n            this._pos.scale(CUSOR_RANGE, this._pos);\n        } \n        this.cursor.transform2D.position = this._pos;\n    }\n}"]}