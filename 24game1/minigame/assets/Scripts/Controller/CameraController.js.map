{"version":3,"sources":["__temp/buildProcess/inlineFunctionProcess/Scripts/Controller/CameraController.ts"],"names":[],"mappings":"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","file":"CameraController.js","sourcesContent":["/*\n * @Athour: kumozheng\n * @Date: 2021-08-31 15:46:58\n * @LastEditors: kumozheng\n * @LastEditTime: 2021-09-01 15:53:10\n * @Description:\n * @FilePath: /RenderDemo copy/assets/Scripts/Controller/CameraController.ts\n */\nimport engine from \"engine\";\nimport EventManager from \"../event/EventManager\";\n\n@engine.decorators.serialize(\"CameraController\")\nexport default class CameraController extends engine.Script {\n  public offsetPos1st: engine.Vector3 = engine.Vector3.createFromNumber(\n    0,\n    1,\n    0\n  );\n  private _offsetPos: engine.Vector3 = this.offsetPos1st;\n\n  private _focusLockOnXAxis: boolean = true;\n  private _angleSum: number = 0;\n  private _angleMax: number = 30;\n  private _speed: number = 1;\n  private _rotSpeed: number = 0.2;\n  private _moveDir: engine.Vector2 = engine.Vector2.ZERO;\n  private _moveable: boolean = false;\n\n  //相机要追踪的对象\n  public bind_entity: engine.Entity | null = null;\n\n  public onAwake() {\n    this.initEvent();\n  }\n\n  public onUpdate() {\n      this.move();\n  }\n\n  public initEvent() {\n    EventManager.on(EventManager.CameraRotate, (rotation: engine.Vector2) => {\n      this.rotate(rotation);\n    });\n    EventManager.on(EventManager.CharacterMove, (dir: engine.Vector2) => {\n      this.startMove(dir);\n    });\n    EventManager.on(EventManager.CharacterMoveStop, () => {\n        this.endMove();\n      });\n  }\n\n  //\n  public startMove(dir: engine.Vector2) {\n    this._moveable = true;\n    this._moveDir = dir;\n  }\n\n  public endMove(){\n    this._moveable = false;\n    this._moveDir = engine.Vector2.ZERO;\n  }\n\n  public move(){\n      if(this._moveable){\n        const forward = this.entity.transform.forward;\n        const right = this.entity.transform.right;\n        const pos = this.entity.transform.position;\n\n        let offsetF = forward.scale(-this._moveDir.y * this._speed);\n        let offsetR = right.scale(-this._moveDir.x * this._speed);\n        let offset = offsetF.add(offsetR);\n        this.entity.transform.position = pos.add(offset);\n      }\n  }\n\n  // 相机在X-axis上旋转\n  public rotateX(rotation: number) {\n    this._angleSum += (-rotation / 5)*this._rotSpeed;\n    if (this._focusLockOnXAxis) {\n      if (this._angleSum < -this._angleMax) this._angleSum = -this._angleMax;\n      if (this._angleSum > this._angleMax) this._angleSum = this._angleMax;\n    }\n    this.entity.transform.euler.x = (this._angleSum * Math.PI) / 180;\n  }\n  \n  // 相机在Y-axis上旋转\n  public rotateY(rotation: number) {\n    let rotateQuat = engine.Quaternion.fromEulerAngles(\n      engine.Vector3.createFromNumber(0, (-rotation / 120) * this._rotSpeed, 0)\n    );\n    this._offsetPos = engine.Vector3.transformQuat(this._offsetPos, rotateQuat);\n    this.entity.transform.rotate(\n      engine.Vector3.createFromNumber(0, (-rotation / 120) * this._rotSpeed, 0),\n      false\n    );\n  }\n\n  public rotate(rot: engine.Vector2){\n    this.rotateX(rot.y);\n    this.rotateY(rot.x);\n  }\n\n\n}\n"]}