var pako=require('./pako');import{fromByteArray}from'./base64.min';var ctx=null;var canvas={'width':0x0,'height':0x0,'lattice_size':0x0,'lattice_data_x':0xc8,'lattice_data_y':0.5,'max_data_x':0x0,'max_data_y':0x0,'data_index':0x0,'rate':0xc8,'center_diff':0x0,'unit_min_x':0x0,'prev_y':0x0,'init':function(_0x542d8e){const _0x318218=this;const _0x3aa8db=wx['createSelectorQuery']();_0x3aa8db['select']('#'+_0x542d8e)['fields']({'node':!![],'size':!![]})['exec'](_0xa134be=>{const _0x263dbb=_0xa134be[0x3a558^0x3a558]['node'];ctx=_0x263dbb['getContext']('2d');let _0x2ac7ca=wx['getSystemInfoSync']();let _0x26a54d=_0x2ac7ca['windowWidth'];let _0x30066b=_0x2ac7ca['windowHeight'];_0x263dbb['width']=_0x26a54d;_0x263dbb['height']=_0x30066b/(0x5ab46^0x5ab44);_0x318218['width']=_0x26a54d;_0x318218['height']=_0x30066b/(0x9a946^0x9a944);_0x318218['lattice_size']=_0x318218['height']/(0x4d073^0x4d067);_0x318218['max_data_x']=Math['floor'](_0x318218['width']/_0x318218['lattice_size']*(_0x318218['lattice_data_x']/((0x3388a^0x33b62)/_0x318218['rate'])));_0x318218['unit_min_x']=_0x318218['lattice_size']/(_0x318218['lattice_data_x']/((0x555f0^0x55618)/_0x318218['rate']));});},'accept_data':function(_0x1aa69b){const _0x4e8130=this;const _0x520a68=Array['prototype']['slice']['call'](new Int8Array(_0x1aa69b['value']));if(_0x4e8130['data_index']>_0x4e8130['max_data_x']-(0x2a6ca^0x2a6c0)){_0x4e8130['data_index']=0xd456a^0xd456a;ctx['clearRect'](0x9fb20^0x9fb20,0xbd126^0xbd126,_0x4e8130['width'],_0x4e8130['height']);}ctx['beginPath']();for(let _0x381a68=0xa76e3^0xa76e3;_0x381a68<(0xe8547^0xe8553);_0x381a68+=0x2){const _0xa2e249=_0x520a68[_0x381a68]>=0x0?_0x520a68[_0x381a68]:_0x520a68[_0x381a68]+(0xc2f26^0xc2e26);const _0x5b5370=(0xd7bef^0xd7bef)-(_0xa2e249+_0x520a68[_0x381a68+0x1]*0x100)/(0x19326^0x191a6)+0x6;const _0x464a09=_0x5b5370/_0x4e8130['lattice_data_y']*_0x4e8130['lattice_size'];if(_0x4e8130['data_index']===0x0){_0x4e8130['center_diff']=_0x464a09-_0x4e8130['height']/0x2;_0x464a09=_0x4e8130['height']/0x2;}if(_0x381a68===0x0){if(_0x4e8130['data_index']===(0x27721^0x27721)){ctx['moveTo'](_0x4e8130['data_index']*_0x4e8130['unit_min_x'],(0x9b89a^0x9b89a)-_0x464a09-_0x4e8130['center_diff']);}else{ctx['moveTo'](_0x4e8130['data_index']*_0x4e8130['unit_min_x'],_0x4e8130['prev_y']);}}else{ctx['lineTo'](_0x4e8130['data_index']*_0x4e8130['unit_min_x'],(0x2a81e^0x2a81e)-_0x464a09-_0x4e8130['center_diff']);}if(_0x381a68>=0x12){_0x4e8130['prev_y']=0x0-_0x464a09-_0x4e8130['center_diff'];}_0x4e8130['data_index']++;}ctx['stroke']();}};var ble={'name':'','ble_status':0x0,'connect_status':![],'device_id':'','battery':0x0,'cv_change_callback':![],'ecg_data':null,'ecg_data_view':null,'ecg_index':0x0,'service_list':{'write':{'serviceId':'0000FFF0-0000-1000-8000-00805F9B34FB','characteristicId':'','isread':![],'desc':'发送'},'read':{'serviceId':'0000FFE0-0000-1000-8000-00805F9B34FB','characteristicId':'','isread':![],'desc':'接收'},'ecg':{'serviceId':'0000FFB1-0000-1000-8000-00805F9B34FB','characteristicId':'','isread':![],'desc':'心电'},'battery':{'serviceId':'0000180F-0000-1000-8000-00805F9B34FB','characteristicId':'','isread':![],'desc':'电池'}},'search':function({success:_0xbbd03d=null,fail:_0x56a6b8=null}={}){const _0x5e41bc=this;return new Promise((_0x413095,_0x57c254)=>{_0x5e41bc['open_ble']()['then'](_0x14a24e=>{console['log']('openBluetoothAdapter\x20res=>',_0x14a24e);_0x5e41bc['ble_status']=0xcc7db^0xcc7da;_0x5e41bc['open_search_ble']();})['then'](_0x630685=>{console['log']('startBluetoothDevicesDiscovery\x20res=>',_0x630685);if(typeof _0xbbd03d=='function'){_0x5e41bc['search_callback_ble'](_0xbbd03d);console['log']('开启搜索');}})['catch'](_0x47e70c=>{console['log'](_0x47e70c);if(typeof _0x56a6b8=='function'){_0x5e41bc['close_search']();_0x56a6b8(_0x47e70c);}});});},'close_search':function(){wx['stopBluetoothDevicesDiscovery']({'success'(_0xfc79c9){console['log']('蓝牙搜索关闭');console['log'](_0xfc79c9);},'fail'(_0x2b7535){console['log'](_0x2b7535);}});},'connect':function({device_id:_0x21e418,success:_0x35744e,fail:_0x218ca2}={}){if(!_0x21e418){console['error']('缺少蓝牙设备Id');if(typeof _0x218ca2=='function'){_0x218ca2({'msg':'缺少蓝牙设备Id'});}return;}const _0x3dff5e=this;_0x3dff5e['close_search']();return new Promise((_0x3fb82b,_0x23c703)=>{_0x3dff5e['connect_ble'](_0x21e418)['then'](async _0x360f95=>{console['log']('蓝牙连接成功');_0x3dff5e['device_id']=_0x21e418;const _0x40eddd=await _0x3dff5e['get_service'](_0x21e418);return _0x40eddd;})['then'](async _0x28c914=>{console['log']('搜索服务成功');console['log'](_0x28c914);let _0x1d2714=_0x28c914['services'];const _0x4ed25e=[];_0x1d2714['forEach'](_0xbec461=>{if(_0xbec461['isPrimary']){const _0x57187c=_0x3dff5e['get_characteristic'](_0x21e418,_0xbec461['uuid']);_0x4ed25e['push'](_0x57187c);}});Promise['all'](_0x4ed25e)['then'](_0xfc8d8e=>{console['log']('全部完成');console['log'](_0xfc8d8e);_0xfc8d8e['forEach'](_0x2b169e=>{for(let _0x38610d in _0x3dff5e['service_list']){let _0x1c171d=_0x3dff5e['service_list'][_0x38610d];if(_0x2b169e['service_id']===_0x1c171d['serviceId']){_0x1c171d['isread']=!![];_0x1c171d['characteristicId']=_0x2b169e['characteristics'][0x0]['uuid'];}}});const _0x310c50=_0x3dff5e['service_list']['battery'];_0x3dff5e['notify'](_0x3dff5e['device_id'],_0x310c50['serviceId'],_0x310c50['characteristicId'])['then'](_0xdd0442=>{_0x3dff5e['notify_callback'](_0x44c1ed=>{if(_0x44c1ed['characteristicId']==='00002A19-0000-1000-8000-00805F9B34FB'){const _0x26d80e=new DataView(_0x44c1ed['value']);_0x3dff5e['battery']=_0x26d80e['getUint8'](0x0);console['log'](_0x3dff5e['battery']);}if(typeof _0x35744e=='function'){_0x35744e('蓝牙连接成功，现在get_battery\x20get_data方法已可用');}});_0x3dff5e['read'](_0x3dff5e['device_id'],_0x310c50['serviceId'],_0x310c50['characteristicId']);});_0x3fb82b(_0xfc8d8e);});})['catch'](_0x518e92=>{if(typeof _0x218ca2=='function'){_0x218ca2(_0x518e92);}});});},'close_connect':function(){const _0x3535e8=this;wx['closeBluetoothAdapter']({'success'(_0x3da1aa){console['log']('蓝牙链接关闭');},'fail'(_0x2991d7){console['error'](_0x2991d7);}});},'get_battery':function(){const _0x5e7530=this;return _0x5e7530['battery'];},'get_data_real_time':function({time:time=0x960fe^0x960fc,callback:_0x3ef347,canvas_id:canvas_id=null}={}){if(typeof _0x3ef347!=='function'){console['error']('需要传入回调方法callback');return;}time=time*(0xc1f4b^0xc1f77);const _0x467a1f=this;_0x467a1f['ecg_data']=new ArrayBuffer(time*0xc8*0x2);_0x467a1f['ecg_data_view']=new DataView(_0x467a1f['ecg_data']);if(canvas_id!==null){canvas['init'](canvas_id);}return new Promise((_0x5989a7,_0x44ace8)=>{const _0x407c8b=_0x467a1f['service_list']['ecg'];_0x467a1f['notify'](_0x467a1f['device_id'],_0x407c8b['serviceId'],_0x407c8b['characteristicId'])['then'](_0x305b7a=>{_0x467a1f['notify_callback'](_0x4afb40=>{_0x467a1f['append_data'](_0x4afb40['value'],_0x467a1f['ecg_index']);_0x467a1f['ecg_index']++;if(_0x467a1f['ecg_index']%(0xc8/(0xb27e6^0xb27ec))===0x0){const _0xa09613={'code':0xc8,'status':0x1,'past_time':_0x467a1f['ecg_index']/(0xc8/(0xa2310^0xa231a)),'data':''};if(_0x467a1f['ecg_index']/(0xc8/(0xd11f2^0xd11f8))===time){_0x467a1f['ecg_index']=0x0;_0xa09613['status']=0x2;_0x467a1f['close_connect']();_0xa09613['data']=_0x467a1f['compress_data']();}_0x3ef347(_0xa09613);}if(canvas_id!==null&&_0x4afb40['characteristicId']===_0x467a1f['service_list']['ecg']['characteristicId']){canvas['accept_data'](_0x4afb40);}});});});},'init':function(){},'reset':function(){},'compress_data':function(){const _0x44b321=this;const _0x3e3427=new Uint8Array(_0x44b321['ecg_data']);const _0x5b3c88=pako['gzip'](_0x3e3427);const _0x9a2d92=fromByteArray(_0x5b3c88);return _0x9a2d92;},'open_ble':function(){const _0x411fb5=this;return new Promise((_0x438587,_0x51e591)=>{wx['openBluetoothAdapter']({'success'(_0x3aa85d){_0x438587(_0x3aa85d);},'fail'(_0x1ab61b){console['log']('openBluetoothAdapter\x20err=>',_0x1ab61b);if(_0x1ab61b&&_0x1ab61b['errMsg']['indexOf']('openBluetoothAdapter:fail')>=0x0){_0x1ab61b['errCode']=0x2710;}_0x51e591(_0x1ab61b);}});});},'open_search_ble':function(){const _0x14f0c6=this;return new Promise((_0x4c48bb,_0x2ed9a4)=>{wx['startBluetoothDevicesDiscovery']({'services':['0000FFB1-0000-1000-8000-00805F9B34FB'],'allowDuplicatesKey':![],'success'(_0x38835d){_0x4c48bb(_0x38835d);},'fail'(_0x52c823){console['log']('startBluetoothDevicesDiscovery\x20err=>',_0x52c823);_0x2ed9a4(_0x52c823);}});});},'search_callback_ble':function(_0x242090){const _0x4b1df4=this;wx['onBluetoothDeviceFound'](function(_0xf0739b){_0x242090(_0xf0739b);});},'connect_ble':function(_0x4a4a1b){return new Promise((_0x38ffc2,_0x46900c)=>{wx['createBLEConnection']({'deviceId':_0x4a4a1b,'success'(_0x28b001){_0x38ffc2(_0x28b001);},'fail'(_0xd25267){console['log']('createBLEConnection\x20err,useTime=>',_0xd25267);_0x46900c(_0xd25267);}});});},'get_service':function(_0x33a0c9){return new Promise((_0x2201bf,_0x5cc44f)=>{wx['getBLEDeviceServices']({'deviceId':_0x33a0c9})['then'](_0x3a7a5c=>{_0x2201bf(_0x3a7a5c);})['catch'](_0x34a255=>{console['log']('device\x20services\x20err=>',_0x34a255);_0x5cc44f(_0x34a255);});});},'get_characteristic':function(_0x5c2816,_0x5e34e6){return new Promise((_0x15f55b,_0x257cd2)=>{wx['getBLEDeviceCharacteristics']({'deviceId':_0x5c2816,'serviceId':_0x5e34e6})['then'](_0x316223=>{console['log']('获取特征成功');console['log']('device\x20getBLEDeviceCharacteristics:',_0x316223['characteristics']);_0x15f55b({'service_id':_0x5e34e6,'characteristics':_0x316223['characteristics']});})['catch'](_0x59e92e=>{console['log']('device\x20getBLEDeviceCharacteristics\x20err=>',_0x59e92e);_0x257cd2(_0x59e92e);});});},'write':function(_0x431a99,_0x405ca8,_0x1f2e18,_0x386254){return new Promise((_0x116094,_0x2438b0)=>{wx['writeBLECharacteristicValue']({'deviceId':_0x431a99,'serviceId':_0x405ca8,'characteristicId':_0x1f2e18,'value':_0x386254,'success':_0x59169a=>{_0x116094(_0x59169a);},'fail':_0x2398ae=>{console['log']('writeBLECharacteristicValue\x20err',_0x2398ae);_0x2438b0(_0x2398ae);}});});},'read':function(_0x3c8a2a,_0x4da3b8,_0x56066d){return new Promise((_0xf3c036,_0x3594ba)=>{wx['readBLECharacteristicValue']({'deviceId':_0x3c8a2a,'serviceId':_0x4da3b8,'characteristicId':_0x56066d,'success'(_0x4a5d19){console['log']('readBLECharacteristicValue:',_0x4a5d19);_0xf3c036(_0x4a5d19);},'fail'(_0x4baadf){console['log']('readBLECharacteristicValue\x20err',_0x4baadf);_0x3594ba(_0x4baadf);}});});},'notify':function(_0x373fcc,_0xa92d76,_0x1b1971){return new Promise((_0x196902,_0x51f53d)=>{wx['notifyBLECharacteristicValueChange']({'state':!![],'type':'notification','deviceId':_0x373fcc,'serviceId':_0xa92d76,'characteristicId':_0x1b1971,'success'(_0x13714a){console['log']('notifyBLECharacteristicValueChange\x20success',_0x13714a['errMsg']);_0x196902(_0x13714a);},'fail'(_0x21d396){console['log']('notifyBLECharacteristicValueChange\x20err',_0x21d396);_0x51f53d(_0x21d396);}});});},'notify_callback':function(_0x70d4d3){const _0x54f180=this;if(_0x54f180['cv_change_callback']){wx['offBLECharacteristicValueChange'](()=>{_0x54f180['cv_change_callback']=![];});}wx['onBLECharacteristicValueChange'](function(_0x2d6aa0){_0x54f180['cv_change_callback']=!![];_0x70d4d3(_0x2d6aa0);});console['log']('数据回调注册成功');},'append_data':function(_0x3d4da3,_0x43bf10){const _0x3fd533=this;const _0x4c856b=new DataView(_0x3d4da3);for(let _0x43a886=0x0;_0x43a886<(0xa51e6^0xa51f2);_0x43a886++){_0x3fd533['ecg_data_view']['setUint8'](_0x43bf10*(0xa8821^0xa8835)+_0x43a886,_0x4c856b['getUint8'](_0x43a886));}}};module['exports']={'ble':ble};